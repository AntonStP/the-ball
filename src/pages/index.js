import Head from "next/head";
import {useDispatch} from "react-redux";
import {useEffect} from "react";
import content, {setPage, useContent} from "@/redux/reducers/content";
import Authorization from "@/components/authorization/Authorization";
import {CSSTransition, SwitchTransition} from "react-transition-group";
import Game from "@/components/game/Game";
import {formContent} from "@/constants/content";

export default function Home() {
    const dispatch = useDispatch();
    const {page} = useContent();

    const component = {
        authorization: <Authorization {...formContent}/>,
        game: <Game/>
    }

    useEffect(() => {
        dispatch(content.thunks.getData());
        let user = null;
        try {
            user = JSON.parse(window?.localStorage?.getItem('user'));
        } catch (error) {
            if (error instanceof DOMException && error.code === 22) {
                console.error("LocalStorage quota exceeded. Unable to save data.");
            } else if (error instanceof TypeError) {
                console.error("localStorage is not supported in this environment.");
            } else {
                console.error("An unknown error occurred while saving to localStorage:", error);
            }
        }
        if (user) dispatch(setPage('game'));
    },[]);


    return (
        <>
            <Head>
                <title>Create Next App</title>
                <meta name="description" content="Generated by create next app"/>
                <meta name="viewport" content="width=device-width, initial-scale=1"/>
                <link rel="icon" href="/favicon.ico"/>
            </Head>
            <main className={`main`}>
                <SwitchTransition>
                    <CSSTransition key={page} timeout={300} classNames={'page'}>
                        <section className={'page'}>
                            {component[page]}
                        </section>
                    </CSSTransition>
                </SwitchTransition>
            </main>
        </>
    );
}
